<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{fragments/layout :: layout(~{::div}, 'lecture')}">

<body>
    <div>
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>강의 관리</h2>
            <a href="javascript:void(0)" data-modal-url="/lectures/new" data-modal-title="Register Lecture"
                class="btn btn-primary open-modal"><i class="bi bi-plus-lg"></i> Register Lecture</a>
        </div>

        <div class="card shadow-sm">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>ID</th>
                                <th>분류</th>
                                <th>제목</th>
                                <th>강의유형</th>
                                <th>장소</th>
                                <th>인원</th>
                                <th>회사명</th>
                                <th>담당자명</th>
                                <th>강의일자</th>
                                <th>강의금액</th>
                                <th>시간</th>
                                <th>지불여부</th>
                                <th>상태</th>
                                <th>알림</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="lecture : ${lectures.content}" th:id="'lecture-row-' + ${lecture.id}"
                                th:data-id="${lecture.id}">
                                <td th:text="${lecture.id}">1</td>
                                <td th:text="${lecture.category != null ? lecture.category.description : '-'}">IT
                                </td>
                                <td th:text="${lecture.title}">Java Spring Boot</td>
                                <td th:text="${lecture.lectureType ?: '-'}">비대면</td>
                                <td th:text="${lecture.location ?: '-'}">줌(Zoom)</td>
                                <td th:text="${lecture.attendeeCount != null ? lecture.attendeeCount + '명' : '-'}">10명
                                </td>
                                <td th:text="${lecture.company != null ? lecture.company.name : '-'}">Samsung</td>
                                <td th:text="${lecture.customer != null ? lecture.customer.name : '-'}">John Doe
                                </td>
                                <td th:text="${#temporals.format(lecture.lectureAt, 'yyyy-MM-dd HH:mm')}">
                                    2024-03-01 14:00
                                </td>
                                <td th:text="${#numbers.formatCurrency(lecture.price)}">₩1,000,000</td>
                                <td th:text="${lecture.totalHours}">1.5</td>
                                <td>
                                    <span th:if="${lecture.isPaid}" class="badge bg-success">Paid</span>
                                    <span th:unless="${lecture.isPaid}"
                                        class="badge bg-warning text-dark">Pending</span>
                                </td>
                                <td>
                                    <span class="badge"
                                        th:classappend="${lecture.status == 'COMPLETED' ? 'bg-success' : (lecture.status == 'CONFIRMED' ? 'bg-info text-dark' : (lecture.status == 'CANCELLED' ? 'bg-danger' : 'bg-secondary'))}"
                                        th:text="${lecture.status == 'COMPLETED' ? '완료' : (lecture.status == 'CONFIRMED' ? '확정' : (lecture.status == 'CANCELLED' ? '취소' : '예정'))}">SCHEDULED</span>
                                </td>
                                <td>
                                    <span class="badge"
                                        th:classappend="${lecture.notificationYn == 'Y' ? 'bg-primary' : 'bg-secondary'}"
                                        th:text="${lecture.notificationYn == 'Y' ? 'ON' : 'OFF'}">OFF</span>
                                </td>
                                <td>
                                    <div class="d-flex gap-2">
                                        <a href="javascript:void(0)" th:id="'edit-btn-' + ${lecture.id}"
                                            th:data-id="${lecture.id}"
                                            th:attr="data-modal-url=@{/lectures/{id}/edit(id=${lecture.id})}"
                                            data-modal-title="Edit Lecture"
                                            class="btn btn-sm btn-outline-primary open-modal">
                                            <i class="bi bi-pencil"></i> Edit
                                        </a>
                                        <a href="javascript:void(0)"
                                            th:attr="data-modal-url=@{/lectures/{id}/feedback(id=${lecture.id})}"
                                            data-modal-title="Lecture Feedback"
                                            class="btn btn-sm btn-outline-success open-modal">
                                            <i class="bi bi-chat-text"></i> Feedback
                                        </a>
                                        <a href="javascript:void(0)"
                                            th:attr="data-modal-url=@{/notifications/mappings/{id}(id=${lecture.id})}"
                                            data-modal-title="Configure Notifications"
                                            class="btn btn-sm btn-outline-info open-modal">
                                            <i class="bi bi-bell"></i> Notify
                                        </a>
                                        <form th:action="@{/lectures/{id}/delete(id=${lecture.id})}" method="post"
                                            onsubmit="return confirm('Are you sure you want to delete this lecture?');">
                                            <button type="submit" class="btn btn-sm btn-outline-danger">
                                                <i class="bi bi-trash"></i> Delete
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                            <tr th:if="${lectures.totalElements == 0}">
                                <td colspan="12" class="text-center py-4">No lectures found.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination Controls -->
                <nav th:if="${lectures.totalPages > 0}" aria-label="Page navigation">
                    <ul class="pagination justify-content-center">
                        <li class="page-item" th:classappend="${lectures.first} ? 'disabled'">
                            <a class="page-link" th:href="@{/lectures(page=${lectures.number - 1})}"
                                aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        <li class="page-item" th:each="i : ${#numbers.sequence(0, lectures.totalPages - 1)}"
                            th:classappend="${lectures.number == i} ? 'active'">
                            <a class="page-link" th:href="@{/lectures(page=${i})}" th:text="${i + 1}">1</a>
                        </li>
                        <li class="page-item" th:classappend="${lectures.last} ? 'disabled'">
                            <a class="page-link" th:href="@{/lectures(page=${lectures.number + 1})}" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>

        <script>
            function fetchCustomersByCompany(companyId) {
                const customerSelect = document.getElementById('customer');
                if (!companyId) {
                    customerSelect.innerHTML = '<option value="">Select Instructor/POC</option>';
                    return;
                }

                fetch('/customers/by-company/' + companyId)
                    .then(response => response.json())
                    .then(data => {
                        customerSelect.innerHTML = '<option value="">Select Instructor/POC</option>';
                        data.forEach(customer => {
                            const option = document.createElement('option');
                            option.value = customer.id;
                            option.text = customer.name;
                            customerSelect.appendChild(option);
                        });
                    })
                    .catch(error => console.error('Error fetching customers:', error));
            }
        </script>
    </div>
</body>

</html>